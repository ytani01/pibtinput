# pibtinputのリファクタリング計画

## 1. デバイス検索ロジックの一元化
- **現状**: `PiBtInput.search_input_devs` は、デバイス名に含まれるキーワードに基づいてデバイスをフィルタリングしています。
- **提案**: より柔軟なフィルタリングメカニズムを導入します。これには以下が含まれます。
    - 複数の検索条件（例：名前、ベンダーID、製品ID）を許可する。
    - `search_input_devs` にカスタムフィルタリング用の呼び出し可能オブジェクト（関数またはラムダ）を渡す。
    - デバイスのリストアップとデバイスのフィルタリングを分離する。

## 2. `CmdInput`のコールバック処理の改善
- **現状**: `CmdInput` の `cb_ev` メソッドには、ループを終了するためのハードコードされたロジック（例：`KEY_S` のチェック）が含まれています。
- **提案**: 終了条件を構成可能にします。
    - ユーザーが終了キーまたはキーの組み合わせを指定できるようにする。
    - 終了ロジックをイベント処理コールバックから分離する。

## 3. ロギングの強化
- **現状**: `mylogger.py` は基本的なロギングを提供しています。
- **提案**:
    - アプリケーション全体で一貫したロギングレベル（`DEBUG`、`INFO`、`WARNING`、`ERROR`、`CRITICAL`）が使用されていることを確認します。
    - 特にエラーシナリオにおいて、ログメッセージにより多くのコンテキストを追加することを検討します。

## 4. `CliBase`とそのサブクラスの改良
- **現状**: `CliBase` とそのサブクラスは良い構造を提供していますが、`parse_instr` と `handle` は「TO BE OVERRIDE」となっています。
- **提案**:
    - `parse_instr` と `handle` をオーバーライドするための、より堅牢なデフォルト実装またはより明確な例/ドキュメントを提供します。
    - `CliBase` にコマンドを動的に登録するメカニズムを追加し、拡張性を高めることを検討します。

## 5. エラー処理
- **現状**: `errmsg` は標準的なエラーメッセージに使用されています。
- **提案**:
    - 特定のアプリケーションエラーに対してカスタム例外クラスを実装し、より多くのコンテキストを提供し、よりきめ細かいエラー処理を可能にします。
    - すべての潜在的なエラーパスが適切に処理され、ユーザーフレンドリーなメッセージが提供されるようにします。

## 6. 型ヒントの一貫性
- **現状**: 型ヒントは使用されていますが、一貫性を改善できます。
- **提案**:
    - 既存のすべてのコードをレビューし、包括的で正確な型ヒントを確実にします。
    - すべての新しいコードおよびリファクタリングされたセクションで型ヒントを強制します。
